"use strict";Object.defineProperty(exports, "__esModule", {value: true});

var _SDBF6KIYcjs = require('../__chunks/SDBF6KIY.cjs');
require('../__chunks/HEFJPUYD.cjs');
require('../__chunks/27ZAGOYG.cjs');


var _EUJ6NNA6cjs = require('../__chunks/EUJ6NNA6.cjs');
require('../__chunks/FXEBKN6G.cjs');



var _6SPJEESBcjs = require('../__chunks/6SPJEESB.cjs');


var _M6ZA7XUPcjs = require('../__chunks/M6ZA7XUP.cjs');



var _DBHIHK7Ccjs = require('../__chunks/DBHIHK7C.cjs');
require('../__chunks/ZNW4LSWU.cjs');
require('../__chunks/GDZQUFNP.cjs');




var _6455U47Tcjs = require('../__chunks/6455U47T.cjs');

// src/combobox/combobox-store.ts
var isSafariOnMobile = _DBHIHK7Ccjs.isSafari.call(void 0, ) && _DBHIHK7Ccjs.isTouchDevice.call(void 0, );
function createComboboxStore(_a = {}) {
  var _b = _a, {
    menu,
    select
  } = _b, props = _6455U47Tcjs.__objRest.call(void 0, _b, [
    "menu",
    "select"
  ]);
  const store = _6SPJEESBcjs.mergeStore.call(void 0, 
    props.store,
    menu == null ? void 0 : menu.omit(
      "baseElement",
      "arrowElement",
      "anchorElement",
      "contentElement",
      "popoverElement",
      "disclosureElement"
    ),
    select == null ? void 0 : select.omit(
      "value",
      "items",
      "renderedItems",
      "baseElement",
      "arrowElement",
      "anchorElement",
      "contentElement",
      "popoverElement",
      "disclosureElement"
    )
  );
  const syncState = store.getState();
  const activeId = _M6ZA7XUPcjs.defaultValue.call(void 0, 
    props.activeId,
    syncState.activeId,
    props.defaultActiveId,
    null
  );
  const composite = _EUJ6NNA6cjs.createCompositeStore.call(void 0, _6455U47Tcjs.__spreadProps.call(void 0, _6455U47Tcjs.__spreadValues.call(void 0, {}, props), {
    store,
    activeId,
    includesBaseElement: _M6ZA7XUPcjs.defaultValue.call(void 0, 
      props.includesBaseElement,
      syncState.includesBaseElement,
      true
    ),
    orientation: _M6ZA7XUPcjs.defaultValue.call(void 0, 
      props.orientation,
      syncState.orientation,
      "vertical"
    ),
    focusLoop: _M6ZA7XUPcjs.defaultValue.call(void 0, props.focusLoop, syncState.focusLoop, true),
    focusWrap: _M6ZA7XUPcjs.defaultValue.call(void 0, props.focusWrap, syncState.focusWrap, true),
    virtualFocus: _M6ZA7XUPcjs.defaultValue.call(void 0, 
      props.virtualFocus,
      syncState == null ? void 0 : syncState.virtualFocus,
      !isSafariOnMobile
    )
  }));
  const popover = _SDBF6KIYcjs.createPopoverStore.call(void 0, _6455U47Tcjs.__spreadProps.call(void 0, _6455U47Tcjs.__spreadValues.call(void 0, {}, props), {
    store,
    placement: _M6ZA7XUPcjs.defaultValue.call(void 0, 
      props.placement,
      syncState.placement,
      "bottom-start"
    )
  }));
  const initialValue = _M6ZA7XUPcjs.defaultValue.call(void 0, 
    props.value,
    syncState.value,
    props.defaultValue,
    ""
  );
  const initialState = _6455U47Tcjs.__spreadProps.call(void 0, _6455U47Tcjs.__spreadValues.call(void 0, _6455U47Tcjs.__spreadValues.call(void 0, {}, composite.getState()), popover.getState()), {
    value: initialValue,
    resetValueOnHide: _M6ZA7XUPcjs.defaultValue.call(void 0, 
      props.resetValueOnHide,
      syncState.resetValueOnHide,
      false
    ),
    activeValue: syncState.activeValue
  });
  const combobox = _6SPJEESBcjs.createStore.call(void 0, initialState, composite, popover, store);
  combobox.setup(
    () => combobox.sync(
      (state) => {
        if (!state.resetValueOnHide)
          return;
        if (state.mounted)
          return;
        combobox.setState("value", initialValue);
      },
      ["resetValueOnHide", "mounted"]
    )
  );
  combobox.setup(
    () => combobox.syncBatch(
      (state) => {
        if (state.mounted)
          return;
        combobox.setState("activeId", activeId);
        combobox.setState("moves", 0);
      },
      ["mounted"]
    )
  );
  combobox.setup(
    () => combobox.sync(
      (state, prevState) => {
        if (state.moves === prevState.moves) {
          combobox.setState("activeValue", void 0);
        }
      },
      ["moves", "activeId"]
    )
  );
  combobox.setup(
    () => combobox.syncBatch(
      (state, prev) => {
        if (state.moves === prev.moves)
          return;
        const { activeId: activeId2 } = combobox.getState();
        const activeItem = composite.item(activeId2);
        combobox.setState("activeValue", activeItem == null ? void 0 : activeItem.value);
      },
      ["moves", "renderedItems"]
    )
  );
  return _6455U47Tcjs.__spreadProps.call(void 0, _6455U47Tcjs.__spreadValues.call(void 0, _6455U47Tcjs.__spreadValues.call(void 0, _6455U47Tcjs.__spreadValues.call(void 0, {}, popover), composite), combobox), {
    setValue: (value) => combobox.setState("value", value)
  });
}


exports.createComboboxStore = createComboboxStore;
